const input = `#.............#................#....#..../....#/...............................#...-..........-.#.-....../....
|#......../|....#..............-#............./...........................-..........-......#........#........
.......||......../....-./.../-...|.|..-......-.|....../................#............|...................-..|..
........./......-.............-#......................|.#./.......|........./......-......../..-.........|....
....../....................-............................................../...../...|.........................
....................#....|/............................./.......-....|......../..........................#....
.|....../|.........-......|.............#..|..................|......../.................|.|............-.|...
.....-............##............#................/......-.........#................#..|../....................
............|..|.......|......../................#.......................|../....../......./.....|............
.#...........#..#.............../.........-/....|......................./.....-./-.........../-........-......
|................#.#-.............../..-............./........./.................#.............|...-.....-....
.........-....|..|......................................#.||...-../..|............../...../.../.........-.....
.....-....-#.................|...........|../.....#...............................|...../../|.................
.#......#......................#....../.../.....-.../.........................../..|...........|..#...........
-............|.........-.-........-.........................|...#...-...........#.|...-....../..........|.....
.........-.......|......#.....#..-...../..../.....#.../............/..........-......./....../...........#.../
..............#........................|.............................-../......-..-...../..................#..
.....#......-.......-.......-......../../../........#.......-..........|......./........................../...
.#...#...................|./#|.-..#...............................#..#.....-....|......................./.....
.................-...|....|.../...../.|.||.....-.|............................-..............#................
........................................../.......................|........#......../.../..............|.....#
.......#......./............................./........../../..........................-#..................|...
...........-...|..#..........-.........#.................././................|./.......|............../.......
......./..................................#...-.........#........#....../............................#......#-
-.|..-|...............|..........................#..........|.-.........#............-.|.............#.....|..
.............................../..............-.....-.......-........................|.......-................
.........#.........-.........|...../......../......./....-...#...................#........#...................
..........#.........#........../...|.................|./...#.......#..........-...............................
./...................|........../#......../....................|..-...........#...#...........|..............|
.....|...........#-.#.......-..........................-....-...................|....|.|...............-......
.|.././......................|.......|.......|..............#...../.................../.#...-.................
...........-........./....|.................|..-.....-............./...................................-..../.
...................#/..|.....-............../-......-..........|........................./...#....-|....|-....
........................./..-..|.#-...............-......-/...../.......#..|................-...#.|.....#.....
#...../.........................../....................-..........|........../..-..-.......#........../.././|.
........................../...#|..................................................../...|.-........-.....|..#.
....#.............................|./.....|...../....#.............#...../.......-...............#..-..../....
.........-.........................|................|........#/.#-...................#..-......./../..........
...-.../............/.................-..........#....../............../...../..........|.....................
..........#...#..................|...-......##......./...-.............-#.................|...../......#......
/..#/.............#....#.............#.......................................|.....#....-............#........
....../..#.|................................#.........../.......-.......-/.....|...................-.....-....
........-....|.............................|....../...............#.......................--..................
................/......|.........-....................-..............|.......................................|
.........#........|...........................#.............|.............................../.................
...|..#....-......../.#...-............................................................/....-...../...........
.............###.../...../.../..........#..............#...........#........................|....../.........#
......-..............|..-..|....-#..#..-...-............#.................#...-.#/.....#......-.#....--.../...
........./...................../...../..|...#.#/.........#.../........................................#.../-..
........#.......|.......|#..|........../..../#........../........#..../..............././..../.............-.#
........................|-............|............................./.-.|...|............../....-#............
../........-.../....................|....................-/.............../.....-...........-....#......||....
.....#..|.....-|../....|./....-|.......-...../..-..#..............#...................../.................|...
...-......../.#...........#.........#../.....|............#..................../.........#................/.#/
...../...|............-..#.../............/............-..............--.-..........././............-........|
.....|...........#.....-...#..../.....-........-.....#.|..............#....-............./...../..............
....#.....-.|....#..../..............#|../.........../......|....#/.......................|............|....-.
........|..--..............|..............-........|.......|.-.........#.............-...........#............
./.||....#......./....#./........../...........././....#.................../..................#...../.........
.......|..#...-.#..#..|.........../..................................-....|........#......|....|..............
...|..........|.........-...............|...............................-.......|...........-..#.......#......
.#.........../../............................-..|...#.....-.........../......-|.../.....|.................-...
........|....../..#..#|..|......|.........|...............................#../.....#....-/........-...........
.................................................#.......|........|.#.-....../.......|.......|............#...
.......|.......#.......|.........|......-......|...|...#.............#.............|/.........................
..........|....................|..........#..........-......./................................................
...../.......|....................|......................././.................................................
........#.............|........--..........#.............../......|...................../............|..#.....
....-............|.........|....|.-.#../-...#....-...-................#|..#-.......|........-............../..
................/........#.....#.....././....|....................-...............#...........-......#........
.#.....|......|...|#......#.#/....#.............-............#.....#.......-...-........-....//..../.....|..-.
..................|..|.-.................../#...........|..../..........#|.....-..|.../.......................
-......-......./........./../.............../..................-..#.......#............|...../../....../......
....../............/...........#.............#............./.........../.......#......|....|.........../......
...#........|..................|............-............-.....-..#..-................/........../........||..
......../..|..-../..../......................../.........#./.-................../...................-.........
.../....|....#.......-..#..........-....#.............|#........../...............-........|..................
..............#.............#|.........-......................-........#|......./.......-.................|...
/..../...-||#-...|#...............................#.......................#.............-................-....
.......-..-....|..................|..............................................................///...-.../.|
......|.......-/........-.-......|....#..-...|...........#...........#.....................-..../.........../.
......-...........|-..#.......|...|.#|.................-....#...................#.#........#.#./.........#....
....../............../.........|...|.......|..../.............................................................
.........../...................-./...#..........#-............./...........#.../.....|......................-.
/..../..../........................................|.#......-/......./....#.........................-......|..
.#./.|.-..........................|...|...........|....../....-....../|...............#..............#...-....
....|...#..........|......-..................|........../..|.-...#........./........|................|........
...#....#........../........../.........#..............-...........................-.|...../..........#.......
...|...........-...........................#........-.........................#...-..-.....#.......|........-.
......#|...........................#.....................................-............/....#...........|......
................../............-........................#.................................................-...
.../....|...............|....................../#.........|....................#....|............#.........|-.
.......................................|....-.........../....#-........|......./............-..|.............#
/.........#..#.........|...............#.......#........./................#....................|.....|........
..................................|.....|.-..|.../......................../-#......|..........................
.................|.....................................................-............|.....|..../.#/..........|
.......#....#....-........|.|..../......-......#...../....................-...........#............-..........
....-.................................-..........-......-................................../.........-#...|...
.....................|......................|.........-............../.../.....-........#.....................
.#./..........-.#...#||................./../........#.........|...#........#....#.#...............-|......|...
..#......//.........../.#........#......|......|........#......#.....-..........|.-..|...../|.................
/.....................#.................-........|...................#.....-..............-/.....#..|../../...
...|..-.../............./.|.................../............/..#...........-....|-............#.......--.......
..............#..#/.....#.........|.#.........................|............|........./................./-..|-.
...........................-.................../...................|#..........#/..|.-........................
.....-.............................../....................#.........|......................|..................
..................#.........../...........#..#/.........|...........|..-........|....#..........-...../.|.....
..........|.......#..#...........#.../......................-...........-.....-........../#|..................
....../.......-........................#|...//...#..-......#.......|..#....................-..........#..-....
|./....|........-./........../.#...#.....|../..../.......-........../.#.....-.................................`;

const test = `.|...#....
|.-.#.....
.....|-...
........|.
..........
.........#
..../.##..
.-.-/..|..
.|....-|.#
..//.|....`;
//find + replace to not have to deal with brakeout characters

const nextDir = {
	'.': [[0], [1], [2], [3]],
	'/': [[1], [0], [3], [2]],
	'#': [[3], [2], [1], [0]],
	'-': [[0], [0, 2], [2], [0, 2]],
	'|': [[1, 3], [1], [1, 3], [3]]
};

const dirs = [[0, 1], [-1, 0], [0, -1], [1, 0]];

let save = {}

let grid = test.split('\n').map(x => x.split(''));

const {evaluate} = funGen(grid, save);

let output = 0;

for(let i = 0; i < grid.length; i++){
	evaluate(i, 0, 0);
    output = Math.max(Object.keys(save).length, output);
	for (let pos in save) {
        delete save[pos];
    }

    evaluate(i, grid[0].length - 1, 2);
    output = Math.max(Object.keys(save).length, output);
	for (let pos in save) {
        delete save[pos];
    }

}

for(let i = 0; i < grid[0].length; i++){
	evaluate(0, i, 3);
    output = Math.max(Object.keys(save).length, output);
	for (let pos in save) {
        delete save[pos];
    }

    evaluate(grid.length - 1, i, 1);
    output = Math.max(Object.keys(save).length, output);
	for (let pos in save) {
        delete save[pos];
    }

}


console.log(output);

// end of main


function funGen(grid, visited){

	function evaluate(posX, posY, dir){

		let pos = [posX, posY];

		if(pos[0] < 0 || pos[0] >= grid.length || pos[1] < 0 || pos[1] >= grid[0].length){
			return;
		}

		while(visited[pos] == undefined || !visited[pos].includes(dir)){
			if(visited[pos] == undefined){
				visited[pos] = [dir];
			}
			else{
				visited[pos].push(dir);
			}

			const next = nextDir[grid[pos[0]][pos[1]]][dir];
			dir = next[0]

			if(next.length > 1){
				evaluate(pos[0] + dirs[next[1]][0], pos[1] + dirs[next[1]][1], next[1]);
			}

			pos[0] += dirs[dir][0];
			pos[1] += dirs[dir][1];

			if(pos[0] < 0 || pos[0] >= grid.length || pos[1] < 0 || pos[1] >= grid[0].length){
				break;
			}
		
		}
	}




	return {evaluate}
}
